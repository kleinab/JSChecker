<body>
  <head>
    <title>Javascript code checker</title>
    <link href="style.css" rel="stylesheet" />

    <!--
    I decided to choose esprima as my js parser. I tried the performance test on esprima's website (http://esprima.org/test/compare.html) and esprima performed slightly better than acorn.
    Additionally, its documentation is more user friendly than acorn's. Acorn displays its entire code base and documents every line. While this is useful to see how short the document is, it's too much information. Esprima's documentation is much easier to "parse" (haha).
    Also, acorn does not provide any examples, while esprima provides several. Finally, esprima describes the form of its output, while acorn does not. Presumably they are the same output, but it would be great to know this ahead of time before running the code.
    -->
    <script type="text/javascript" src="jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="esprima.js"></script>
    <script type="text/javascript" src="jschecker.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        var whitelistReqs = [];
        var blacklistReqs = [];
        var structureReqs = $("#structure").text();

        $("#whitelistForm").on("change", function() {
          var whitelistReqs = $("#whitelistForm input:checked").map(function(){
              return $(this).val();
            }).get();
        });

        $("#blacklistForm").on("change", function() {
          var blacklistReqs = $("#blacklistForm input:checked").map(function(){
              return $(this).val();
            }).get();
        });

        $("#structure").on("keyup", function() {
          structureReqs = $(this).text();
          console.log(structureReqs);
        });

        $("#code").on("keyup", function() {
          var code = $(this).val();
          var ast = esprima.parse(code);

          whitelist(ast, whitelistReqs);
          blacklist(ast, blacklistReqs);
          structure(ast, structureReqs);
        });
      });
    </script>

  </head>

  <body>
    <div class="row">
      <span id="codeColumn">
        <h1>Submit your javascript code.</h1>
        <textarea id="code"></textarea>
      </div>
      <span id="feedbackColumn">
        <h1>Requirements</h1>
        Must have: <br />
        <form id="whitelistForm">
          <input type="checkbox" value="VariableDeclaration">Variable<br>
          <input type="checkbox" value="FunctionDeclaration">Function<br>
          <input type="checkbox" value="ForStatement">For Loop<br>
          <input type="checkbox" value="ReturnStatement">Return Statement<br>
          <input type="checkbox" value="BlockStatement">Block
        </form>
        Cannot have: <br />
        <form id="blacklistForm">
          <input type="checkbox" value="VariableDeclaration">Variable<br>
          <input type="checkbox" value="FunctionDeclaration">Function<br>
          <input type="checkbox" value="ForStatement">For Loop<br>
          <input type="checkbox" value="ReturnStatement">Return Statement<br>
          <input type="checkbox" value="BlockStatement">Block
        </form>
        Structure: <br />
        <textarea id="structure">
{
  "type": "FunctionDeclaration", 
  "body": [
    {"type": "ReturnStatement"}, 
    {"type": "VariableDeclaration"}
  ]
}
        </textarea>
      </span>
    </div>
  </body>
</body>